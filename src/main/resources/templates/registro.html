<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Registro de Usuario</title>

  <!-- base del proyecto -->
  <link rel="stylesheet" th:href="@{/css/styles-admin.css}">
  <!-- estilos SOLO de registro -->
  <link rel="stylesheet" th:href="@{/css/registro.css}">
</head>

<body>
  <main class="page page--auth">
    <!-- fondo decorativo -->
    <div class="bg-blur b1" aria-hidden="true"></div>
    <div class="bg-blur b2" aria-hidden="true"></div>

    <header class="topbar topbar--auth">
      <div class="topbar__title">
        <div class="icon">üìù</div>
        <div>
          <h1>Registro</h1>
          <p>Crea tu cuenta para acceder al sistema de citas</p>
        </div>
      </div>

      <a th:href="@{/login}" class="btn btn--ghost">‚Üê Volver al inicio</a>
    </header>

    <section class="card card--form card--auth">
      <div class="card__head">
        <h2>Datos del usuario</h2>
        <span class="chip">Nuevo</span>
      </div>

      <form class="form"
            th:action="@{/registrar}"
            th:object="${usuarioDTO}"
            method="post"
            id="registroForm"
            novalidate>

        <div class="grid grid--2">
          <div class="field">
            <label for="documento">Documento</label>
            <input type="text" th:field="*{documento}" id="documento" placeholder="Ej: 1234567890" required>
            <p class="error" id="errorDocumento"
               th:if="${#fields.hasErrors('documento')}" th:errors="*{documento}"></p>
          </div>

          <div class="field">
            <label for="correo">Correo</label>
            <input type="email" th:field="*{correo}" id="correo" placeholder="usuario@dominio.com" required>
            <p class="error" id="errorCorreo"
               th:if="${#fields.hasErrors('correo')}" th:errors="*{correo}"></p>
          </div>

          <div class="field">
            <label for="nombre">Nombre</label>
            <input type="text" th:field="*{nombre}" id="nombre" placeholder="Ej: Juan" required>
            <p class="error" th:if="${#fields.hasErrors('nombre')}" th:errors="*{nombre}"></p>
          </div>

          <div class="field">
            <label for="apellido">Apellido</label>
            <input type="text" th:field="*{apellido}" id="apellido" placeholder="Ej: P√©rez" required>
            <p class="error" th:if="${#fields.hasErrors('apellido')}" th:errors="*{apellido}"></p>
          </div>

          <div class="field">
            <label for="contrasena">Contrase√±a</label>
            <input type="password" th:field="*{contrasena}" id="contrasena" placeholder="M√≠nimo 6 caracteres" required>
            <p class="error" th:if="${#fields.hasErrors('contrasena')}" th:errors="*{contrasena}"></p>
          </div>

          <div class="field">
            <label for="confirmarContrasena">Confirmar contrase√±a</label>
            <input type="password" th:field="*{confirmarContrasena}" id="confirmarContrasena" placeholder="Repite la contrase√±a" required>
            <p class="error" th:if="${#fields.hasErrors('confirmarContrasena')}" th:errors="*{confirmarContrasena}"></p>
          </div>
        </div>

        <div class="form-actions form-actions--bottom">
          <button type="submit" class="btn btn--primary">Registrar</button>
          <a th:href="@{/login}" class="btn btn--soft">Ya tengo cuenta</a>
        </div>

        <div th:if="${mensaje}" class="alert alert--ok" th:text="${mensaje}"></div>
      </form>
    </section>
  </main>

  <script>
    const formulario = document.getElementById('registroForm');
    const documentoInput = document.getElementById('documento');
    const correoInput = document.getElementById('correo');
    const errorCorreo = document.getElementById('errorCorreo');
    const contrasenaInput = document.getElementById('contrasena');
    const confirmarContrasenaInput = document.getElementById('confirmarContrasena');
    const nombreInput = document.getElementById('nombre');
    const apellidoInput = document.getElementById('apellido');

    // Documento: solo n√∫meros
    documentoInput.addEventListener('input', function() {
      this.value = this.value.replace(/\D/g, '');
    });

    // Correo: validaci√≥n en tiempo real
    correoInput.addEventListener('input', function() {
      const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!regex.test(this.value)) {
        errorCorreo.textContent = "El correo debe tener un formato v√°lido (ej: usuario@dominio.com)";
      } else {
        errorCorreo.textContent = "";
      }
    });

    // Validaci√≥n antes de enviar
    formulario.addEventListener('submit', function(e) {
      if (!documentoInput.value || !nombreInput.value || !correoInput.value || !apellidoInput.value ||
          !contrasenaInput.value || !confirmarContrasenaInput.value) {
        alert("Todos los campos deben ser diligenciados completamente.");
        e.preventDefault();
        return;
      }

      if (contrasenaInput.value !== confirmarContrasenaInput.value) {
        alert("Las contrase√±as no coinciden.");
        e.preventDefault();
        return;
      }

      const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!regex.test(correoInput.value)) {
        alert("El correo no tiene un formato v√°lido.");
        e.preventDefault();
      }
    });
  </script>
</body>
</html>

